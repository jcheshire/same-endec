<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAME Encoder/Decoder</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>SAME Encoder/Decoder</h1>
            <p>Emergency Alert System (EAS) Message Tool</p>
        </header>

        <div class="tabs">
            <button class="tab-button active" data-tab="encode">Encode Message</button>
            <button class="tab-button" data-tab="decode">Decode WAV</button>
        </div>

        <!-- Encode Tab -->
        <div id="encode-tab" class="tab-content active">
            <div class="section">
                <h2>Build SAME Message</h2>
                <form id="encode-form">
                    <div class="form-group">
                        <label for="event-code">Event Code:</label>
                        <select id="event-code" required>
                            <option value="">Loading...</option>
                        </select>
                        <span class="help-text" id="event-description"></span>
                    </div>

                    <div class="form-group">
                        <label for="originator">Originator:</label>
                        <select id="originator" required>
                            <option value="WXR">WXR - National Weather Service</option>
                            <option value="PEP">PEP - Primary Entry Point</option>
                            <option value="CIV">CIV - Civil Authority</option>
                            <option value="EAS">EAS - EAS Participant</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="county-search">Search Counties:</label>
                        <input type="text" id="county-search" placeholder="Type county name or FIPS code (e.g., Montgomery or 024031)" autocomplete="off">
                        <span class="help-text">Search by county name or FIPS code (5-6 digits). First digit specifies subdivision (0=whole county).</span>
                        <div id="search-results" class="search-results hidden"></div>
                        <div id="subdivision-selector-container" class="subdivision-selector hidden"></div>
                    </div>

                    <div class="form-group">
                        <label>Selected Counties:</label>
                        <div id="selected-counties" class="selected-counties">
                            <span class="help-text">No counties selected. Search and click to add.</span>
                        </div>
                        <input type="hidden" id="location-codes" required>
                    </div>

                    <div class="form-group">
                        <label for="duration">Duration:</label>
                        <select id="duration" required>
                            <option value="+0015">15 minutes</option>
                            <option value="+0030" selected>30 minutes</option>
                            <option value="+0045">45 minutes</option>
                            <option value="+0100">1 hour</option>
                            <option value="+0130">1 hour 30 minutes</option>
                            <option value="+0200">2 hours</option>
                            <option value="+0230">2 hours 30 minutes</option>
                            <option value="+0300">3 hours</option>
                            <option value="+0330">3 hours 30 minutes</option>
                            <option value="+0400">4 hours</option>
                            <option value="+0430">4 hours 30 minutes</option>
                            <option value="+0500">5 hours</option>
                            <option value="+0530">5 hours 30 minutes</option>
                            <option value="+0600">6 hours</option>
                        </select>
                        <span class="help-text">Select alert duration (15-min increments up to 1hr, 30-min beyond)</span>
                    </div>

                    <div class="form-group">
                        <label for="callsign">Callsign (optional):</label>
                        <input type="text" id="callsign" placeholder="SAMEENDC" maxlength="8" style="text-transform: uppercase;">
                        <span class="help-text">Up to 8 characters (defaults to SAMEENDC if empty)</span>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-primary">Encode to WAV</button>
                    </div>
                </form>

                <div id="encode-output" class="output-box hidden">
                    <h3>Encoded SAME Message</h3>

                    <div class="message-preview">
                        <strong>Message String:</strong>
                        <pre id="preview-text"></pre>
                    </div>

                    <div class="audio-outputs">
                        <div class="audio-output-item">
                            <h4>Header (SAME Alert Tones)</h4>
                            <audio id="header-audio" controls></audio>
                            <button id="download-header-btn" class="btn btn-success">Download Header</button>
                        </div>

                        <div class="audio-output-item">
                            <h4>End of Message (EOM)</h4>
                            <audio id="eom-audio" controls src="eom.wav"></audio>
                            <button id="download-eom-btn" class="btn btn-success">Download EOM</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Raw Encode Section -->
            <div class="section">
                <h2>Encode Raw SAME String</h2>
                <form id="raw-encode-form">
                    <div class="form-group">
                        <label for="raw-message">SAME Message:</label>
                        <input type="text" id="raw-message" placeholder="ZCZC-WXR-TOR-024031+0030-3171500-SCIENCE-" required>
                        <span class="help-text">Complete SAME protocol message</span>
                    </div>
                    <button type="submit" class="btn btn-primary">Encode Raw Message</button>
                </form>
            </div>
        </div>

        <!-- Decode Tab -->
        <div id="decode-tab" class="tab-content">
            <div class="section">
                <h2>Decode WAV File</h2>
                <form id="decode-form">
                    <div class="form-group">
                        <label for="wav-file">Upload WAV File:</label>
                        <input type="file" id="wav-file" accept=".wav,audio/wav" required>
                        <span class="help-text">Max size: 10MB</span>
                    </div>
                    <button type="submit" class="btn btn-primary">Decode</button>
                </form>

                <div id="decode-output" class="output-box hidden">
                    <h3>Decoded Message</h3>
                    <div id="decode-text"></div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <a href="reference.html" class="footer-link">SAME Protocol Reference â†’</a>
        </footer>

        <div id="error-box" class="error-box hidden">
            <span class="error-close">&times;</span>
            <p id="error-message"></p>
        </div>

        <div id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
